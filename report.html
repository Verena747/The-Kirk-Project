<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit a Report | The Kirk Project</title>
  <link rel="stylesheet" href="style.css" />
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit a Report | The Kirk Project</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="header"></div>

  <main style="max-width:800px;margin:3rem auto;text-align:center;">
    <h2>Submit a Report</h2>
    <p>Please provide as much information as possible. All submissions are reviewed confidentially.</p>

    <form id="reportForm" action="https://formspree.io/f/mzzjqknl" method="POST" style="text-align:left;">
      <input type="hidden" name="_redirect" value="https://thekirkproject.vercel.app/thankyou.html" />
      <input type="hidden" name="_subject" value="New Threat Report Submission" />

      <label>Your Name (optional)</label>
      <input type="text" name="name" placeholder="Leave blank to stay anonymous" style="width:100%;padding:0.75rem;border-radius:10px;border:1px solid #ccc;margin-bottom:1rem;" />

      <label>Your Email (optional)</label>
      <input type="email" name="email" placeholder="Only if you’d like follow-up" style="width:100%;padding:0.75rem;border-radius:10px;border:1px solid #ccc;margin-bottom:1rem;" />

      <label>Platform / Source</label>
      <input type="text" name="platform" required placeholder="e.g., Twitter, Reddit, Facebook" style="width:100%;padding:0.75rem;border-radius:10px;border:1px solid #ccc;margin-bottom:1rem;" />

      <label>Username / Handle of Commenter</label>
      <input type="text" name="username" placeholder="Enter the username or screen name" style="width:100%;padding:0.75rem;border-radius:10px;border:1px solid #ccc;margin-bottom:1rem;" />

      <label>Comment or Post Content</label>
      <textarea name="comment" rows="4" required placeholder="Paste the full comment or message here" style="width:100%;padding:0.75rem;border-radius:10px;border:1px solid #ccc;margin-bottom:1rem;"></textarea>

      <label>Context / Additional Information</label>
      <textarea name="context" rows="4" placeholder="Add any context, screenshots, or details" style="width:100%;padding:0.75rem;border-radius:10px;border:1px solid #ccc;margin-bottom:1rem;"></textarea>

      <label>Location (if relevant)</label>
      <input type="text" name="location" placeholder="City, State, or Region" style="width:100%;padding:0.75rem;border-radius:10px;border:1px solid #ccc;margin-bottom:1rem;" />

      <button type="submit" style="background:#1e3d59;color:white;padding:0.9rem;width:100%;border:none;border-radius:10px;cursor:pointer;font-weight:600;">Submit Report</button>
    </form>
  </main>

  <div id="footer"></div>

  <script>
    fetch("header.html").then(r => r.text()).then(t => document.getElementById("header").innerHTML = t);
    fetch("footer.html").then(r => r.text()).then(t => document.getElementById("footer").innerHTML = t);
  </script>
</body>
</html>

</head>

<body>
  <header>
    <h1>The Kirk Project</h1>
    <p>Threat Reporting & Prevention Network</p>
  </header>

  <section id="report" class="report-section">
    <div class="report-container">
      <h2>Submit a Report</h2>
      <p>
        Please provide as much information as possible. All submissions are reviewed confidentially.
      </p>

      <!-- ✅ Updated Form with iframe redirect -->
      <form
        id="reportForm"
        action="https://formspree.io/f/mzzjqknl"
        method="POST"
        target="hidden_iframe"
        onsubmit="submitted=true;"
      >
        <input type="hidden" name="_subject" value="New Threat Report Submission" />

        <label for="name">Your Name (optional)</label>
        <input type="text" id="name" name="name" placeholder="Leave blank to stay anonymous" />

        <label for="email">Your Email (optional)</label>
        <input type="email" id="email" name="email" placeholder="Only if you’d like follow-up" />

        <label for="platform">Platform / Source</label>
        <input
          type="text"
          id="platform"
          name="platform"
          placeholder="e.g., Twitter, Reddit, Facebook, YouTube"
          required
        />

        <label for="username">Username / Handle of Commenter</label>
        <input
          type="text"
          id="username"
          name="username"
          placeholder="Enter the username or screen name (if known)"
        />

        <label for="comment">Comment or Post Content</label>
        <textarea
          id="comment"
          name="comment"
          rows="4"
          required
          placeholder="Paste the full comment, post, or message text here"
        ></textarea>

        <label for="context">Context / Additional Information</label>
        <textarea
          id="context"
          name="context"
          rows="4"
          placeholder="Add any context, screenshots, or relevant details"
        ></textarea>

        <label for="location">Location (if relevant)</label>
        <input type="text" id="location" name="location" placeholder="City, State, or Region" />

        <button type="button" id="analyzeBtn">Analyze Threat</button>
        <div id="result"></div>

        <button type="submit" id="submitBtn" style="display:none;">Submit Report</button>
      </form>

      <!-- Hidden iframe for silent Formspree submission -->
      <iframe
        name="hidden_iframe"
        id="hidden_iframe"
        style="display:none;"
        onload="if(submitted){window.location='thankyou.html';}"
      ></iframe>
    </div>
  </section>

  <footer>
    <p>© 2025 The Kirk Project. All rights reserved.</p>
  </footer>

  <!-- Needed global variable -->
  <script>
    var submitted = false;
  </script>

  <script>
    // ---------- THREAT ANALYSIS ----------
    document.getElementById("analyzeBtn").addEventListener("click", function () {
      const comment = document.getElementById("comment").value.toLowerCase();
      const result = document.getElementById("result");
      const submitBtn = document.getElementById("submitBtn");

      if (!comment.trim()) {
        result.textContent = "Please enter a comment before analyzing.";
        result.style.display = "block";
        result.className = "";
        return;
      }

      const highKeywords = ["kill", "shoot", "bomb", "attack", "threat", "murder", "gun", "explode", "massacre"];
      const moderateKeywords = ["hate", "die", "destroy", "hurt", "fight", "violence", "revenge"];
      let score = 0;

      highKeywords.forEach(word => { if (comment.includes(word)) score += 3; });
      moderateKeywords.forEach(word => { if (comment.includes(word)) score += 1; });

      let level, colorClass;
      if (score >= 5) { level = "High Threat Level"; colorClass = "high"; }
      else if (score >= 2) { level = "Moderate Threat Level"; colorClass = "moderate"; }
      else { level = "Low Threat Level"; colorClass = "low"; }

      result.textContent = `⚠️ ${level} detected.`;
      result.className = colorClass;
      result.style.display = "block";

      if (score >= 1) {
        submitBtn.style.display = "block";
        submitBtn.textContent = "Proceed to Submit";
      } else {
        submitBtn.style.display = "block";
        submitBtn.textContent = "Submit (No threat detected)";
      }
    });
  </script>
</body>
</html>
